return(sa_qarast)
}
qa_bands <- sa_qabands("~/data/raw/images")
X
Y <- list(X[grep("2021.*165069", X)],
X[grep("2015.*165069", X)])
Y
names(Y) <- list("blma2021_qa", "blma2015_qa")
Y
J <- lapply(Y, rast)
J
names(Y) <- list(c("blma2021_qa", "blma2015_qa"))
Y
J <- lapply(Y, rast)
J
sa_qabands <- function(mine_areas) {
qa_bands <- list.files(mine_areas,
recursive = T,
pattern = "\\PIXEL.TIF$",
full.names = TRUE)
sa_qa    <- list(qa_bands[grep("2021.*165069", qa_bands)],
qa_bands[grep("2015.*165069", qa_bands)],
qa_bands[grep("2020.*165067", qa_bands)],
qa_bands[grep("2020.*164068", qa_bands)],
qa_bands[grep("2015.*165067", qa_bands)],
qa_bands[grep("2015.*164068", qa_bands)],
qa_bands[grep("2020.*165069", qa_bands)],
qa_bands[grep("2020.*164069", qa_bands)],
qa_bands[grep("2015.*165069", qa_bands)],
qa_bands[grep("2015.*164069", qa_bands)])
names(sa_qa)    <- list("blma2021_qa",
"blma2015_qa",
"plma2020A_qa",
"plma2020B_qa",
"plma2015A_qa",
"plma2015B_qa",
"ancbe2020A_qa",
"ancbe2020B_qa",
"ancbe2015_qa",
"ancbe2015_qa")
sa_qarast <- lapply(sa_qa, rast)
return(sa_qarast)
}
qa_bands <- sa_qabands("~/data/raw/images")
sa_qabands <- function(mine_areas) {
qa_bands <- list.files(mine_areas,
recursive = T,
pattern = "\\PIXEL.TIF$",
full.names = TRUE)
sa_qa    <- list(qa_bands[grep("2021.*165069", qa_bands)],
qa_bands[grep("2015.*165069", qa_bands)],
qa_bands[grep("2020.*165067", qa_bands)],
qa_bands[grep("2020.*164068", qa_bands)],
qa_bands[grep("2015.*165067", qa_bands)],
qa_bands[grep("2015.*164068", qa_bands)],
qa_bands[grep("2020.*165069", qa_bands)],
qa_bands[grep("2020.*164069", qa_bands)],
qa_bands[grep("2015.*165069", qa_bands)],
qa_bands[grep("2015.*164069", qa_bands)])
names(sa_qa)    <- list("blma2021_qa",
"blma2015_qa",
"plma2020A_qa",
"plma2020B_qa",
"plma2015A_qa",
"plma2015B_qa",
"ancbe2020A_qa",
"ancbe2020B_qa",
"ancbe2015_qa",
"ancbe2015_qa")
sa_qarast <- lapply(sa_qa, rast)
return(sa_qarast)
}
qa_bands <- sa_qabands("~/data/raw/images")
X
Y <- list(qa_bands[grep("2021.*165069", qa_bands)],
qa_bands[grep("2015.*165069", qa_bands)],
qa_bands[grep("2020.*165067", qa_bands)],
qa_bands[grep("2020.*164068", qa_bands)],
qa_bands[grep("2015.*165067", qa_bands)],
qa_bands[grep("2015.*164068", qa_bands)],
qa_bands[grep("2020.*165069", qa_bands)],
qa_bands[grep("2020.*164069", qa_bands)],
qa_bands[grep("2015.*165069", qa_bands)],
qa_bands[grep("2015.*164069", qa_bands)])
Y
sa_qabands <- function(mine_areas) {
qa_bands <- list.files(mine_areas,
recursive = T,
pattern = "\\PIXEL.TIF$",
full.names = TRUE)
sa_qa    <- list(qa_bands[grep("2021.*165069", qa_bands)],
qa_bands[grep("2015.*165069", qa_bands)],
qa_bands[grep("2020.*165067", qa_bands)],
qa_bands[grep("2020.*164068", qa_bands)],
qa_bands[grep("2015.*165067", qa_bands)],
qa_bands[grep("2015.*164068", qa_bands)],
qa_bands[grep("2020.*165069", qa_bands)],
qa_bands[grep("2020.*164069", qa_bands)],
qa_bands[grep("2015.*165069", qa_bands)],
qa_bands[grep("2015.*164069", qa_bands)])
names(sa_qa)    <- list("blma2021_qa",
"blma2015_qa",
"plma2020A_qa",
"plma2020B_qa",
"plma2015A_qa",
"plma2015B_qa",
"ancbe2020A_qa",
"ancbe2020B_qa",
"ancbe2015_qa",
"ancbe2015_qa")
sa_qarast <- lapply(sa_qa, rast)
return(sa_qarast)
}
qa_bands <- sa_qabands("~/data/raw/images")
Y <- list(qa_bands[grep("2021.*165069", qa_bands)],
qa_bands[grep("2015.*165069", qa_bands)])
Y
Y[grep("2021.*165069"), Y]
X
X[grep("2021.*165069"), X]
X[grep("2021.*165069"), X]
X[grep("2020.*165069"), X]
class(X)
bands_all      <- list.files("~/data/raw/images",
recursive = T,
pattern = glob2rx("*B*"),
full.names = TRUE)
class(bands_all)
bands_17       <- bands_all[grep("B10", bands_all, invert = TRUE)]
class(bands_17)
bands_list     <- bands_17[grep("2021.*165069", bands_17)]
bands_list
X
X[grep("2021.*16569", X)]
Xing <- list.files("~/data/raw/images",
recursive = T,
pattern = "\\PIXEL.TIF$",
full.names = TRUE)
Xing
Xing[grep("2021.*16569", Xing)]
Xing[grep("2021", Xing)]
Xing[grep("2020", Xing)]
Xing[grep("2020.*165069", Xing)]
Y
Y <- list(Xing[grep("2021", Xing)],
Xing[grep("2015.*165069", Xing)])
Y
sa_qabands <- function(mine_areas) {
qa_bands <- list.files(mine_areas,
recursive = T,
pattern = "\\PIXEL.TIF$",
full.names = TRUE)
sa_qa    <- list(qa_bands[grep("2021", qa_bands)],
qa_bands[grep("2015.*165069", qa_bands)],
qa_bands[grep("2020.*165067", qa_bands)],
qa_bands[grep("2020.*164068", qa_bands)],
qa_bands[grep("2015.*165067", qa_bands)],
qa_bands[grep("2015.*164068", qa_bands)],
qa_bands[grep("2020.*165069", qa_bands)],
qa_bands[grep("2020.*164069", qa_bands)],
qa_bands[grep("2015.*165069", qa_bands)],
qa_bands[grep("2015.*164069", qa_bands)])
names(sa_qa)    <- list("blma2021_qa",
"blma2015_qa",
"plma2020A_qa",
"plma2020B_qa",
"plma2015A_qa",
"plma2015B_qa",
"ancbe2020A_qa",
"ancbe2020B_qa",
"ancbe2015_qa",
"ancbe2015_qa")
sa_qarast <- lapply(sa_qa, rast)
return(sa_qarast)
}
qa_bands <- sa_qabands("~/data/raw/images")
rm(J)
qa_bands <- list.files("~/data/raw/images",
recursive = T,
pattern = "\\PIXEL.TIF$",
full.names = TRUE)
qa_bands
Y
sa_qa    <- list(qa_bands[grep("2021", qa_bands)],
qa_bands[grep("2015.*165069", qa_bands)],
qa_bands[grep("2020.*165067", qa_bands)],
qa_bands[grep("2020.*164068", qa_bands)],
qa_bands[grep("2015.*165067", qa_bands)],
qa_bands[grep("2015.*164068", qa_bands)],
qa_bands[grep("2020.*165069", qa_bands)],
qa_bands[grep("2020.*164069", qa_bands)],
qa_bands[grep("2015.*165069", qa_bands)],
qa_bands[grep("2015.*164069", qa_bands)])
sa_qa
anc15B <- qa_bands[grep("2015.*164069", qa_bands)]
anc15B
anc15B <- qa_bands[grep("2015", qa_bands)]
anc15B
anc15B <- qa_bands[grep(".*164069", qa_bands)]
anc15B
anc15B <- qa_bands[grep(".*164069", qa_bands)]
anc15B
qa_bands <- list.files("~/data/raw/images",
recursive = T,
pattern = "\\PIXEL.TIF$",
full.names = TRUE)
qa_bands
anc15B <- qa_bands[grep(".*164069", qa_bands)]
anc15B
anc15B <- qa_bands[grep("2015.*164069", qa_bands)]
anc15B
sa_qa    <- list(qa_bands[grep("2021", qa_bands)],
qa_bands[grep("2015.*165069", qa_bands)],
qa_bands[grep("2020.*165067", qa_bands)],
qa_bands[grep("2020.*164068", qa_bands)],
qa_bands[grep("2015.*165067", qa_bands)],
qa_bands[grep("2015.*164068", qa_bands)],
qa_bands[grep("2020.*165069", qa_bands)],
qa_bands[grep("2020.*164069", qa_bands)],
qa_bands[grep("2015.*165069", qa_bands)],
qa_bands[grep("2015.*164069", qa_bands)])
sa_qa
sa_qabands <- function(mine_areas) {
qa_bands <- list.files(mine_areas,
recursive = T,
pattern = "\\PIXEL.TIF$",
full.names = TRUE)
sa_qa    <- list(qa_bands[grep("2021", qa_bands)],
qa_bands[grep("2015.*165069", qa_bands)],
qa_bands[grep("2020.*165067", qa_bands)],
qa_bands[grep("2020.*164068", qa_bands)],
qa_bands[grep("2015.*165067", qa_bands)],
qa_bands[grep("2015.*164068", qa_bands)],
qa_bands[grep("2020.*165069", qa_bands)],
qa_bands[grep("2020.*164069", qa_bands)],
qa_bands[grep("2015.*165069", qa_bands)],
qa_bands[grep("2015.*164069", qa_bands)])
names(sa_qa)    <- list("blma2021_qa",
"blma2015_qa",
"plma2020A_qa",
"plma2020B_qa",
"plma2015A_qa",
"plma2015B_qa",
"ancbe2020A_qa",
"ancbe2020B_qa",
"ancbe2015_qa",
"ancbe2015_qa")
sa_qarast <- lapply(sa_qa, rast)
return(sa_qarast)
}
qa_bands <- sa_qabands("~/data/raw/images")
qa_bands
rm(Xing)
rm(Y)
rm(qa_bands)
rm(anc15B)
rm(sa_qa)
rm(bands_list)
rm(bands_17)
rm(bands_all)
qa_bands <- sa_qabands("~/data/raw/images")
qa_bands
sa_qabands <- function(mine_areas) {
qa_bands <- list.files(mine_areas,
recursive = T,
pattern = "\\PIXEL.TIF$",
full.names = TRUE)
sa_qa    <- list(qa_bands[grep("2021", qa_bands)],
qa_bands[grep("2015.*165069", qa_bands)],
qa_bands[grep("2020.*165067", qa_bands)],
qa_bands[grep("2020.*164068", qa_bands)],
qa_bands[grep("2015.*165067", qa_bands)],
qa_bands[grep("2015.*164068", qa_bands)],
qa_bands[grep("2020.*165069", qa_bands)],
qa_bands[grep("2020.*164069", qa_bands)],
qa_bands[grep("2015.*165069", qa_bands)],
qa_bands[grep("2015.*164069", qa_bands)])
names(sa_qa)    <- list("blma2021_qa",
"blma2015_qa",
"plma2020A_qa",
"plma2020B_qa",
"plma2015A_qa",
"plma2015B_qa",
"ancbe2020A_qa",
"ancbe2020B_qa",
"ancbe2015A_qa",
"ancbe2015B_qa")
sa_qarast <- lapply(sa_qa, rast)
return(sa_qarast)
}
qa_bands <- sa_qabands("~/data/raw/images")
qa_bands
qa_bandsCAT <- function(qa) {
qab            <- qa[[1]]
activeCat(qab) <- 0
return(qab)
}
qa_CAT <- lapply(qa_bands, qa_bandsCAT)
qa_CAT
aois_clean
aois_clean_vers1 <- aois_clean
aois_clean_vers1
rm(bands17)
rm(qaband)
rm(aoi_fun)
aois <- function(aoi_fun, qaband, bands17, aoi_post) {
sa_aoi        <- list(
"blma2021"  = aoi_fun(qaband[[1]], bands17[[1]], aoi_post[[1]]),
"blma2015"  = aoi_fun(qaband[[2]], bands17[[2]], aoi_post[[1]]),
"plma2020A" = aoi_fun(qaband[[3]], bands17[[3]], aoi_post[[2]]),
"plma2020B" = aoi_fun(qaband[[4]], bands17[[4]], aoi_post[[2]]),
"plma2015A" = aoi_fun(qaband[[5]], bands17[[5]], aoi_post[[2]]),
"plma2015B" = aoi_fun(qaband[[6]], bands17[[6]], aoi_post[[2]]),
"ancbe2020A" = aoi_fun(qaband[[7]], bands17[[7]], aoi_post[[3]]),
"ancbe2020B" = aoi_fun(qaband[[8]], bands17[[8]], aoi_post[[3]]),
"ancbe2015A" = aoi_fun(qaband[[9]], bands17[[9]], aoi_post[[3]]),
"ancbe2015B" = aoi_fun(qaband[[10]], bands17[[10]], aoi_post[[3]]))
AncbPlma2020_2015  <- list(
"ancbe2020" = mosaic(sa_aoi$ancbe2020A, sa_aoi$ancbe2020B),
"ancbe2015" = mosaic(sa_aoi$ancbe2015A, sa_aoi$ancbe2015B),
"plma2020" = mosaic(sa_aoi$plma2020A, sa_aoi$plma2020B),
"plma2015" = mosaic(sa_aoi$plma2015A, sa_aoi$plma2015A))
saAOI_combined <- c(sa_aoi, AncbPlma2020_2015)
saAOI          <- saAOI_combined[-c(3:10)]
return(saAOI)
}
aois_clean <- aois(aoi_L8, qa_CAT, sa_bands, sa_posts)
aois_clean
aois_clean_vers1
aois_clean_bandnames <- function(aois_list) {
bandlist <- aois_list
for (i in 1:length(bandlist)) {
names(bandlist[[i]][[1:7]]) <- gsub(pattern = ".*SR",
replacement = names(bandlist[i]),
names(bandlist[[i]][[1:7]]))
}
return(bandlist)
}
aois_final <- aois_clean_bandnames(aois_clean)
aois_final
rm(aois_clean_vers1)
comp   <- function(bands17, x, y, z) {
comps    <- c(bands17[[x]], bands17[[y]], bands17[[z]])
return(comps)
}
aois_RGB <- function(bands17) {
aois_comp <- list("blma2021_b543" = comp(bands17[[1]], 5, 4, 3),
"blma2015_b543" = comp(bands17[[2]], 5, 4, 3),
"blma2021_b654" = comp(bands17[[1]], 6, 5, 4),
"blma2015_b654" = comp(bands17[[2]], 6, 5, 4),
"ancbe2020_b543" = comp(bands17[[3]], 5, 4, 3),
"ancbe2015_b543" = comp(bands17[[4]], 5, 4, 3),
"ancbe2020_b654" = comp(bands17[[3]], 6, 5, 4),
"ancbe2015_b654" = comp(bands17[[4]], 6, 5, 4),
"plma2020_b543" = comp(bands17[[5]], 5, 4, 3),
"plma2015_b543" = comp(bands17[[6]], 5, 4, 3),
"plma2020_b654" = comp(bands17[[5]], 6, 5, 4),
"plma2015_b654" = comp(bands17[[6]], 6, 5, 4))
aois_compnames <- paste0(names(aois_comp), ".tif")
names(aois_comp) <- aois_compnames
for (i in 1:length(aois_comp)) {
aoisComp <- writeRaster(aois_comp[[i]],
file.path("~/results/output",
names(aois_comp[i])),
overwrite=TRUE,
filetype="GTiff")
}
return(aoisComp)
}
aois_compst <- aois_RGB(aois_final)
indices <- function(bands17, x, y) {
bandx <- bands17[[x]]
bandy <- bands17[[y]]
indices <- (bandx - bandy)/(bandx + bandy)
return(indices)
}
ndvi_fun <- function(bands17) {
ndvi <- list("blma2021_ndvi" = indices(bands17[[1]], 5, 4),
"blma2015_ndvi" = indices(bands17[[2]], 5, 4),
"ancb2020_ndvi" = indices(bands17[[3]], 5, 4),
"ancb2015_ndvi" = indices(bands17[[4]], 5, 4),
"plma2020_ndvi" = indices(bands17[[5]], 5, 4),
"plma2015_ndvi" = indices(bands17[[6]], 5, 4))
ndvinames <- paste0(names(ndvi), ".tif")
names(ndvi) <- ndvinames
for (i in 1:length(ndvi)) {
writeRaster(ndvi[[i]],
file.path("~/results/output", names(ndvi[i])),
overwrite=TRUE,
filetype="GTiff")
}
return(ndvi)
}
aois_ndvi <- ndvi_fun(aois_final)
trains <- list(
blma2021_train = vect("~/data/temp/training-samples/blma2021_train500V3.shp"),
blma2015_train = vect("~/data/temp/training-samples/blma2015_train500V2.shp"),
plma2020_train = vect("~/data/temp/training-samples/plma2020_train500Weq_4cls.shp"),
plma2015_train = vect("~/data/temp/training-samples/plma2015_train500_4clsv2.shp"),
ancb2020_train = vect("~/data/temp/training-samples/ancb2020_train500.shp"),
ancb2015_train = vect("~/data/temp/training-samples/ancb2015_train500.shp"))
blma2021_train <- vect("~/data/temp/training-samples/blma2021_train500V3.shp")
blma2015_train <- vect("~/data/temp/training-samples/blma2015_train500V2.shp")
plma2020_train <- vect("~/data/temp/training-samples/plma2020_train500Weq_4cls.shp")
plma2015_train <- vect("~/data/temp/training-samples/plma2015_train500_4clsv2.shp")
ancb2020_train <- vect("~/data/temp/training-samples/ancb2020_train500.shp")
ancb2015_train <- vect("~/data/temp/training-samples/ancb2015_train500.shp")
trains <- list(
"blma2021_train" = vect("~/data/temp/training-samples/blma2021_train500V3.shp"),
"blma2015_train" = vect("~/data/temp/training-samples/blma2015_train500V2.shp"),
"plma2020_train" = vect("~/data/temp/training-samples/plma2020_train500Weq_4cls.shp"),
"plma2015_train" = vect("~/data/temp/training-samples/plma2015_train500_4clsv2.shp"),
"ancb2020_train" = vect("~/data/temp/training-samples/ancb2020_train500.shp"),
"ancb2015_train" = vect("~/data/temp/training-samples/ancb2015_train500.shp"))
plot(trains$blma2021_train)
plot(trains$plma2020_train)
plot(trains$ancb2015_train)
samps <- function(train, aoi) {
Tsamps  <- spatSample(train, 4000, method = "random")
sampsXY <- as.matrix(geom(Tsamps)[,c('x','y')])
sampsdf <- extract(aoi, sampsXY)
samps   <- data.frame(class = Tsamps$Classname, sampsdf)
return(samps)
}
aois_final$blma2021[[3:6]]
aois_final$blma2021[[c(3:6)]]
blma2021_samps     <- samps(trains$blma2021_train, aois_final$blma2021[[3:6]])
blma2021_samps
blma2021_sampsDist <- table(as.character(blma2021_samps$class))
blma2021_sampsDist
sampsSP <- function(samps) {
sampsSP             <- aggregate(samps[, -1], list(samps$class), mean)
rownames(sampsSP)   <- sampsSP[, 1]
sampsSP             <- sampsSP[, -1]
names(sampsSP)[1:5] <- 1:5
sampsSP             <- t(sampsSP)
sampsSP             <- as.data.frame(sampsSP)
sampsSP             <- cbind(bands = rownames(sampsSP), sampsSP)
rownames(sampsSP)   <- NULL
sampsSP             <- melt(sampsSP, id.vars = "bands", variable.name = "lulc")
sampsSP$bands       <- as.numeric(sampsSP$bands)
sampsSP             <- ggplot(sampsSP, aes(bands, value)) +
geom_line(aes(color = lulc), size = 1) +
ggtitle("Spectral Profiles") +
labs(x = "Bands", y = "Reflectance") +
scale_colour_manual("LULC",
values = colp,
labels = clasp)
return(sampsSP)
}
sampsSP(blma2021_samps)
sampsSP <- function(samps) {
sampsSP             <- aggregate(samps[, -1], list(samps$class), mean)
rownames(sampsSP)   <- sampsSP[, 1]
sampsSP             <- sampsSP[, -1]
names(sampsSP)[1:4] <- 1:4
sampsSP             <- t(sampsSP)
sampsSP             <- as.data.frame(sampsSP)
sampsSP             <- cbind(bands = rownames(sampsSP), sampsSP)
rownames(sampsSP)   <- NULL
sampsSP             <- melt(sampsSP, id.vars = "bands", variable.name = "lulc")
sampsSP$bands       <- as.numeric(sampsSP$bands)
sampsSP             <- ggplot(sampsSP, aes(bands, value)) +
geom_line(aes(color = lulc), size = 1) +
ggtitle("Spectral Profiles") +
labs(x = "Bands", y = "Reflectance") +
scale_colour_manual("LULC",
values = colp,
labels = clasp)
return(sampsSP)
}
sampsSP(blma2021_samps)
lulc_classes <- list(class_BlmaAncb = c("built & bare",
"dense vegetation",
"sparse vegetation",
"water"),
class_Plma = c("built & bare",
"dense vegetation",
"sparse vegetation",
"wetland",
"water"))
lulc_cols <- list(cols_BlmaAncb = c('darkorange',
'darkgreen',
'green',
'deepskyblue'),
colp_Plma = c('darkorange',
'darkgreen',
'green',
'lightcyan',
'deepskyblue'))
sampsSP <- function(samps) {
sampsSP             <- aggregate(samps[, -1], list(samps$class), mean)
rownames(sampsSP)   <- sampsSP[, 1]
sampsSP             <- sampsSP[, -1]
names(sampsSP)[1:4] <- 1:4
sampsSP             <- t(sampsSP)
sampsSP             <- as.data.frame(sampsSP)
sampsSP             <- cbind(bands = rownames(sampsSP), sampsSP)
rownames(sampsSP)   <- NULL
sampsSP             <- melt(sampsSP, id.vars = "bands", variable.name = "lulc")
sampsSP$bands       <- as.numeric(sampsSP$bands)
sampsSP             <- ggplot(sampsSP, aes(bands, value)) +
geom_line(aes(color = lulc), size = 1) +
ggtitle("Spectral Profiles") +
labs(x = "Bands", y = "Reflectance") +
scale_colour_manual("LULC",
values = lulc_cols$colp_Plma,
labels = lulc_classes$class_BlmaAncb)
return(sampsSP)
}
sampsSP(blma2021_samps)
??setup
