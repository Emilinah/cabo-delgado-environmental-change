overwrite=TRUE,
filetype="GTiff")
}
rm(dummy)
for (i in 1:length(aois_comp)) {
writeRaster(aois_comp[[i]],
file.path("~/results/output", names(aois_comp[i])),
overwrite=TRUE,
filetype="GTiff")
}
rm(Y)
rm(aois_comp)
aois_RGB <- function() {
aois_comp <- list("blma2021_b543" = comp(aois_final[[1]], 5, 4, 3),
"blma2015_b543" = comp(aois_final[[2]], 5, 4, 3),
"blma2021_b654" = comp(aois_final[[1]], 6, 5, 4),
"blma2015_b654" = comp(aois_final[[2]], 6, 5, 4),
"ancbe2020_b543" = comp(aois_final[[3]], 5, 4, 3),
"ancbe2015_b543" = comp(aois_final[[4]], 5, 4, 3),
"ancbe2020_b654" = comp(aois_final[[3]], 6, 5, 4),
"ancbe2015_b654" = comp(aois_final[[4]], 6, 5, 4),
"plma2020_b543" = comp(aois_final[[5]], 5, 4, 3),
"plma2015_b543" = comp(aois_final[[6]], 5, 4, 3),
"plma2020_b654" = comp(aois_final[[5]], 6, 5, 4),
"plma2015_b654" = comp(aois_final[[6]], 6, 5, 4))
for (i in 1:length(aois_comp)) {
writeRaster(aois_comp[[i]],
file.path("~/results/output", names(aois_comp[i])),
overwrite=TRUE,
filetype="GTiff")
}
return(aois_comp)
}
aois_RGB <- function(bands17) {
aois_comp <- list("blma2021_b543" = comp(bands17[[1]], 5, 4, 3),
"blma2015_b543" = comp(bands17[[2]], 5, 4, 3),
"blma2021_b654" = comp(bands17[[1]], 6, 5, 4),
"blma2015_b654" = comp(bands17[[2]], 6, 5, 4),
"ancbe2020_b543" = comp(bands17[[3]], 5, 4, 3),
"ancbe2015_b543" = comp(bands17[[4]], 5, 4, 3),
"ancbe2020_b654" = comp(bands17[[3]], 6, 5, 4),
"ancbe2015_b654" = comp(bands17[[4]], 6, 5, 4),
"plma2020_b543" = comp(bands17[[5]], 5, 4, 3),
"plma2015_b543" = comp(bands17[[6]], 5, 4, 3),
"plma2020_b654" = comp(bands17[[5]], 6, 5, 4),
"plma2015_b654" = comp(bands17[[6]], 6, 5, 4))
for (i in 1:length(aois_comp)) {
writeRaster(aois_comp[[i]],
file.path("~/results/output", names(aois_comp[i])),
overwrite=TRUE,
filetype="GTiff")
}
return(aois_comp)
}
aois_comp <- aois_RGB(aois_final)
aois_comp
plotRGB(aois_comp$ancbe2015_b543, r = 1, b =2, g = 3, stretch="lin")
Dummy
Dummy <- aois_final
rm(Dummy)
Dummy <- aois_clean
Dummy
for (i in 1:length(Dummy)) {
names(Dummy[[i]][[1:7]]) <- gsub(pattern = ".*SR",
replacement = names(Dummy[i]),
names(Dummy[[i]][[1:7]]))
}
Dummy
rm(aois_final)
aois_clean_bandnames <- function(aois_list) {
for (i in 1:length(aois_list)) {
names(aois_list[[i]][[1:7]]) <- gsub(pattern = ".*SR",
replacement = names(aois_list[i]),
names(aois_list[[i]][[1:7]]))
}
}
aois_final <- aois_clean_bandnames(aois_clean)
aois_final
aois_clean_bandnames <- function(aois_list) {
bandlist <- aois_list
for (i in 1:length(bandlist)) {
names(bandlist[[i]][[1:7]]) <- gsub(pattern = ".*SR",
replacement = names(bandlist[i]),
names(bandlist[[i]][[1:7]]))
}
}
aois_final <- aois_clean_bandnames(aois_clean)
aois_final
aois_clean
aois_clean_bandnames <- function(aois_list) {
bandlist <- aois_list
for (i in 1:length(bandlist)) {
names(bandlist[[i]][[1:7]]) <- gsub(pattern = ".*SR",
replacement = names(bandlist[i]),
names(bandlist[[i]][[1:7]]))
}
}
aois_final <- aois_clean_bandnames(aois_clean)
aois_final
aois_clean_bandnames <- function(aois_list) {
bandlist <- aois_list
for (i in 1:length(bandlist)) {
names(bandlist[[i]][[1:7]]) <- gsub(pattern = ".*SR",
replacement = names(bandlist[i]),
names(bandlist[[i]][[1:7]]))
}
return(bandlist)
}
aois_final <- aois_clean_bandnames(aois_clean)
aois_final
rm(Dummy)
aois_final
aois_ndvi <- function(bands17) {
ndvi <- list("blma2021_ndvi" <- indices(bands17[[1]], 5, 4),
"blma2015_ndvi" <- indices(bands17[[2]], 5, 4),
"ancb2020_ndvi" <- indices(bands17[[3]], 5, 4),
"ancb2015_ndvi" <- indices(bands17[[4]], 5, 4),
"plma2020_ndvi" <- indices(bands17[[5]], 5, 4),
"plma2015_ndvi" <- indices(bands17[[6]], 5, 4))
for (i in 1:length(ndvi)) {
writeRaster(ndvi[[i]],
file.path("~/results/output",
names(ndvi[i])),
overwrite=TRUE,
filetype="GTiff")
}
return(ndvi)
}
rm(aois_ndvi)
ndvi_fun <- function(bands17) {
ndvi <- list("blma2021_ndvi" <- indices(bands17[[1]], 5, 4),
"blma2015_ndvi" <- indices(bands17[[2]], 5, 4),
"ancb2020_ndvi" <- indices(bands17[[3]], 5, 4),
"ancb2015_ndvi" <- indices(bands17[[4]], 5, 4),
"plma2020_ndvi" <- indices(bands17[[5]], 5, 4),
"plma2015_ndvi" <- indices(bands17[[6]], 5, 4))
for (i in 1:length(ndvi)) {
writeRaster(ndvi[[i]],
file.path("~/results/output",
names(ndvi[i])),
overwrite=TRUE,
filetype="GTiff")
}
return(ndvi)
}
aois_ndvi <- aois_ndvi(aois_final)
aois_ndvi <- ndvi_fun(aois_final)
indices <- function(bands17, x, y) {
bandx <- bands17[[x]]
bandy <- bands17[[y]]
indices <- (bandx - bandy)/(bandx + bandy)
return(indices)
}
aois_ndvi <- ndvi_fun(aois_final)
aois_ndvi <- ndvi_fun(aois_final)
aois_ndvi <- ndvi_fun(aois_final)
aois_final
J <- aois_final
V <- list("blma2021_ndvi" <- indices(bands17[[1]], 5, 4),
"blma2015_ndvi" <- indices(bands17[[2]], 5, 4))
V <- list("blma2021_ndvi" <- indices(J[[1]], 5, 4),
"blma2015_ndvi" <- indices(J[[2]], 5, 4))
V <- list("blma2021_ndvi" <- indices(J[[1]], 5, 4),
"blma2015_ndvi" <- indices(J[[2]], 5, 4))
V
J
J[[1]]
J[[1]][[4:5]]
indices <- function(bands17, x, y) {
bandx <- bands17[[x]]
bandy <- bands17[[y]]
indices <- (bandx - bandy)/(bandx + bandy)
return(indices)
}
H <- indices(J[[1]], 5, 4)
H
names(J[1])
H
H <- list("x" = indices(J[[1]], 5, 4),
"y" = indices(J[[2]], 5, 4))
H
H[[1]]
H[1]
writeRaster(H[[1]],
file.path("~/results/output", names(ndvi[1])),
overwrite=TRUE,
filetype="GTiff")
writeRaster(H[[1]],
file.path("~/results/output", names(H[1])),
overwrite=TRUE,
filetype="GTiff")
for (i in 1:length(H)) {
writeRaster(H[[i]],
file.path("~/results/output", names(H[i])),
overwrite=TRUE,
filetype="GTiff")
}
ndvi_fun <- function(bands17) {
ndvi <- list("blma2021_ndvi" <- indices(bands17[[1]], 5, 4),
"blma2015_ndvi" <- indices(bands17[[2]], 5, 4),
"ancb2020_ndvi" <- indices(bands17[[3]], 5, 4),
"ancb2015_ndvi" <- indices(bands17[[4]], 5, 4),
"plma2020_ndvi" <- indices(bands17[[5]], 5, 4),
"plma2015_ndvi" <- indices(bands17[[6]], 5, 4))
return(ndvi)
for (i in 1:length(ndvi)) {
writeRaster(ndvi[[i]],
file.path("~/results/output", names(ndvi[i])),
overwrite=TRUE,
filetype="GTiff")
}
}
aois_ndvi <- ndvi_fun(aois_final)
aois_ndvi
ndvi_fun <- function(bands17) {
ndvi <- list("blma2021_ndvi" = indices(bands17[[1]], 5, 4),
"blma2015_ndvi" = indices(bands17[[2]], 5, 4),
"ancb2020_ndvi" = indices(bands17[[3]], 5, 4),
"ancb2015_ndvi" = indices(bands17[[4]], 5, 4),
"plma2020_ndvi" = indices(bands17[[5]], 5, 4),
"plma2015_ndvi" = indices(bands17[[6]], 5, 4))
return(ndvi)
for (i in 1:length(ndvi)) {
writeRaster(ndvi[[i]],
file.path("~/results/output", names(ndvi[i])),
overwrite=TRUE,
filetype="GTiff")
}
}
aois_ndvi <- ndvi_fun(aois_final)
aois_ndvi
ndvi_fun <- function(bands17) {
ndvi <- list("blma2021_ndvi" = indices(bands17[[1]], 5, 4),
"blma2015_ndvi" = indices(bands17[[2]], 5, 4),
"ancb2020_ndvi" = indices(bands17[[3]], 5, 4),
"ancb2015_ndvi" = indices(bands17[[4]], 5, 4),
"plma2020_ndvi" = indices(bands17[[5]], 5, 4),
"plma2015_ndvi" = indices(bands17[[6]], 5, 4))
for (i in 1:length(ndvi)) {
writeRaster(ndvi[[i]],
file.path("~/results/output", names(ndvi[i])),
overwrite=TRUE,
filetype="GTiff")
}
return(ndvi)
}
aois_ndvi <- ndvi_fun(aois_final)
aois_ndvi
rm(J)
rm(V)
rm(H)
blma2021_train <- vect("~/data/temp/training-samples/blma2021_train500V3.shp")
plot(blma2021_train)
blma2015_train <- vect("~/data/temp/training-samples/blma2015_train500V2.shp")
plot(blma2015_train)
V <- "~/results/output/plma2015_b543"
V
V <- rast("~/results/output/plma2015_b543")
V
L <- aois_final
aois_compL <- list("blma2021_b543" = comp(L[[1]], 5, 4, 3),
"blma2015_b543" = comp(L[[2]], 5, 4, 3))
names(aois_compL)
aois_compLnames <- paste0(names(aois_compL), ".tif")
names(aois_compLnames)
names(aois_compLnames)[1:2]
names(aois_compLnames)[c(1:2)]
names(aois_compLnames)[1]
aois_compLnames[1]
aois_compLnames[1:2]
aois_compLnames
aois_compLnames
names(aois_compL)
names(aois_compL)
names(aois_compL) <- aois_compLnames
aois_compL
for (i in 1:length(aois_compL)) {
writeRaster(aois_compL[[i]],
file.path("~/results/output",
names(aois_compL[i])),
overwrite=TRUE,
filetype="GTiff")
}
aois_comp
names(aois_comp)
aois_RGB <- function(bands17) {
aois_comp <- list("blma2021_b543" = comp(bands17[[1]], 5, 4, 3),
"blma2015_b543" = comp(bands17[[2]], 5, 4, 3),
"blma2021_b654" = comp(bands17[[1]], 6, 5, 4),
"blma2015_b654" = comp(bands17[[2]], 6, 5, 4),
"ancbe2020_b543" = comp(bands17[[3]], 5, 4, 3),
"ancbe2015_b543" = comp(bands17[[4]], 5, 4, 3),
"ancbe2020_b654" = comp(bands17[[3]], 6, 5, 4),
"ancbe2015_b654" = comp(bands17[[4]], 6, 5, 4),
"plma2020_b543" = comp(bands17[[5]], 5, 4, 3),
"plma2015_b543" = comp(bands17[[6]], 5, 4, 3),
"plma2020_b654" = comp(bands17[[5]], 6, 5, 4),
"plma2015_b654" = comp(bands17[[6]], 6, 5, 4))
aois_compnames <- paste0(names(aois_comp), ".tif")
names(aois_comp) <- aois_compnames
for (i in 1:length(aois_comp)) {
writeRaster(aois_comp[[i]],
file.path("~/results/output",
names(aois_comp[i])),
overwrite=TRUE,
filetype="GTiff")
}
return(aois_comp)
}
rm(aois_comp)
aois_compst <- aois_RGB(aois_final)
rm(L)
rm(aois_compLnames)
rm(aois_compL)
rm(aois_ndvi)
ndvi_fun <- function(bands17) {
ndvi <- list("blma2021_ndvi" = indices(bands17[[1]], 5, 4),
"blma2015_ndvi" = indices(bands17[[2]], 5, 4),
"ancb2020_ndvi" = indices(bands17[[3]], 5, 4),
"ancb2015_ndvi" = indices(bands17[[4]], 5, 4),
"plma2020_ndvi" = indices(bands17[[5]], 5, 4),
"plma2015_ndvi" = indices(bands17[[6]], 5, 4))
ndvinames <- paste0(names(ndvi), ".tif")
names(ndvi) <- ndvinames
for (i in 1:length(ndvi)) {
writeRaster(ndvi[[i]],
file.path("~/results/output", names(ndvi[i])),
overwrite=TRUE,
filetype="GTiff")
}
return(ndvi)
}
aois_ndvi <- ndvi_fun(aois_final)
rm(V)
list.files(mine_areas, pattern = "\\.shp$", full.names = TRUE)
list.files("~/data/raw/mines", pattern = "\\.shp$", full.names = TRUE)
list.files("~/data/raw/mines/admposts", pattern = "\\.shp$", full.names = TRUE)
study_areasPosts <- function(mine_areas) {
study_Posts <- list.files(mine_areas,
pattern = "\\.shp$",
full.names = TRUE)
blmapost        <- vect(study_Posts[2])
plmapost        <- vect(study_Posts[3])
ancbpost        <- vect(study_Posts[1])
return(list("blma" = blma,
"plma" = plma,
"ancb" = ancb))
}
sa_posts <- study_areasPosts("~/data/raw/mines/admposts")
study_areasPosts <- function(mine_areas) {
study_Posts <- list.files(mine_areas,
pattern = "\\.shp$",
full.names = TRUE)
blmapost        <- vect(study_Posts[2])
plmapost        <- vect(study_Posts[3])
ancbpost        <- vect(study_Posts[1])
return(list("blma" = blmapost,
"plma" = plmapost,
"ancb" = ancbpost))
}
sa_posts <- study_areasPosts("~/data/raw/mines/admposts")
plot(sa_posts$blma)
list.files("~/data/raw/mines/stdyareas", pattern = "\\.shp$", full.names = TRUE)
list.files("~/data/raw/mines/stdyareas", pattern = "\\.shp$", full.names = TRUE)
study_areas <- function(mine_areas) {
study_areas <- list.files(mine_areas,
pattern = "\\.shp$",
full.names = TRUE)
blma        <- vect(study_areas[2])
plma        <- vect(study_areas[3])
ancb        <- vect(study_areas[1])
return(list("blma" = blma,
"plma" = plma,
"ancb" = ancb))
}
sa <- study_areas("~/data/raw/mines/stdyareas")
list.files("~/data/raw/mines/mines", pattern = "\\.shp$", full.names = TRUE)
list.files("~/data/raw/mines/pacs", pattern = "\\.shp$", full.names = TRUE)
study_pacs <- function(mine_areas) {
PACs       <- list.files(mine_areas,
pattern = "\\.shp$",
full.names = TRUE)
twigg_pacs <- st_read(PACs[3],
query = "SELECT NomeN1 FROM \"twiggPACS\"")
total_pacs <- st_read(PACs[2],
query = "SELECT Settlement FROM \"totalPACS\"")
gk_pacs    <- st_read(PACs[1],
query = "SELECT Community FROM \"gkPACS\"")
return(list("twigg_pacs" = twigg_pacs,
"total_pacs" = total_pacs,
"gk_pacs" = gk_pacs))
}
pacs <- study_pacs("~/data/raw/mines/pacs")
x <- rast("U:/PhD/20221107_back-up_CD env change/results/output/blma2021_b543")
aoi_L8  <- function(QAband, bands17, aoi_post) {
cloudmask     <- classify(QAband, rbind(c(21824, 21824), c(21952, 21952)),
others = NA)
b17_clear     <- mask(bands17, cloudmask)
b17_clearProj <- project(b17_clear, moz_crs)
aoi_crop      <- crop(b17_clearProj, aoi_post, snap = "near", mask = TRUE)
aoi_cropmsk    <- mask(aoi_crop, aoi_post)
return(aoi_cropSV)
}
sa_posts
study_areasPosts <- function(mine_areas) {
study_Posts <- list.files(mine_areas,
pattern = "\\.shp$",
full.names = TRUE)
blmapost        <- vect(study_Posts[2])
plmapost        <- vect(study_Posts[3])
ancbpost        <- vect(study_Posts[1])
return(list("blmapost" = blmapost,
"plmapost" = plmapost,
"ancbpost" = ancbpost))
}
sa_posts <- study_areasPosts("~/data/raw/mines/admposts")
sa_posts
aois <- function(aoi_fun, qaband, bands17, aoi_post) {
sa_aoi        <- list(
"blma2021"  = aoi_fun(qaband[[1]], bands17[[1]], aoi_post[[1]]),
"blma2015"  = aoi_fun(qaband[[2]], bands17[[2]], aoi_post[[1]]),
"plma2020A" = aoi_fun(qaband[[3]], bands17[[3]], aoi_post[[2]]),
"plma2020B" = aoi_fun(qaband[[4]], bands17[[4]], aoi_post[[2]]),
"plma2015A" = aoi_fun(qaband[[5]], bands17[[5]], aoi_post[[2]]),
"plma2015B" = aoi_fun(qaband[[6]], bands17[[6]], aoi_post[[2]]),
"ancbe2020" = aoi_fun(qaband[[7]], bands17[[7]], aoi_post[[3]]),
"ancbe2015" = aoi_fun(qaband[[8]], bands17[[8]], aoi_post[[3]]))
plma2020_2015  <- list(
"plma2020" = mosaic(sa_aoi$plma2020A, sa_aoi$plma2020B),
"plma2015" = mosaic(sa_aoi$plma2015A, sa_aoi$plma2015A))
saAOI_combined <- c(sa_aoi, plma2020_2015)
saAOI          <- saAOI_combined[-c(3:6)]
return(saAOI)
}
aois_clean <- aois(aoi_L8, qa_CAT, sa_bands, sa_posts)
aoi_L8  <- function(QAband, bands17, aoi_post) {
cloudmask     <- classify(QAband, rbind(c(21824, 21824), c(21952, 21952)),
others = NA)
b17_clear     <- mask(bands17, cloudmask)
b17_clearProj <- project(b17_clear, moz_crs)
aoi_crop      <- crop(b17_clearProj, aoi_post, snap = "near", mask = TRUE)
aoi_cropmsk    <- mask(aoi_crop, aoi_post)
return(aoi_cropmsk)
}
#TODO use if else and for loop for chunk below?
aois <- function(aoi_fun, qaband, bands17, aoi_post) {
sa_aoi        <- list(
"blma2021"  = aoi_fun(qaband[[1]], bands17[[1]], aoi_post[[1]]),
"blma2015"  = aoi_fun(qaband[[2]], bands17[[2]], aoi_post[[1]]),
"plma2020A" = aoi_fun(qaband[[3]], bands17[[3]], aoi_post[[2]]),
"plma2020B" = aoi_fun(qaband[[4]], bands17[[4]], aoi_post[[2]]),
"plma2015A" = aoi_fun(qaband[[5]], bands17[[5]], aoi_post[[2]]),
"plma2015B" = aoi_fun(qaband[[6]], bands17[[6]], aoi_post[[2]]),
"ancbe2020" = aoi_fun(qaband[[7]], bands17[[7]], aoi_post[[3]]),
"ancbe2015" = aoi_fun(qaband[[8]], bands17[[8]], aoi_post[[3]]))
plma2020_2015  <- list(
"plma2020" = mosaic(sa_aoi$plma2020A, sa_aoi$plma2020B),
"plma2015" = mosaic(sa_aoi$plma2015A, sa_aoi$plma2015A))
saAOI_combined <- c(sa_aoi, plma2020_2015)
saAOI          <- saAOI_combined[-c(3:6)]
return(saAOI)
}
aois_clean <- aois(aoi_L8, qa_CAT, sa_bands, sa_posts)
aois_clean_bandnames <- function(aois_list) {
bandlist <- aois_list
for (i in 1:length(bandlist)) {
names(bandlist[[i]][[1:7]]) <- gsub(pattern = ".*SR",
replacement = names(bandlist[i]),
names(bandlist[[i]][[1:7]]))
}
return(bandlist)
}
aois_final <- aois_clean_bandnames(aois_clean)
aois_clean_bandnames <- function(aois_list) {
bandlist <- aois_list
for (i in 1:length(bandlist)) {
names(bandlist[[i]][[1:7]]) <- gsub(pattern = ".*SR",
replacement = names(bandlist[i]),
names(bandlist[[i]][[1:7]]))
}
return(bandlist)
}
aois_clean
tmpFiles(current=TRUE, orphan=TRUE, old=TRUE, remove=FALSE)
tmpFiles(current=TRUE, orphan=TRUE, old=TRUE, remove=TRUE)
aois_clean_bandnames <- function(aois_list) {
bandlist <- aois_list
for (i in 1:length(bandlist)) {
names(bandlist[[i]][[1:7]]) <- gsub(pattern = ".*SR",
replacement = names(bandlist[i]),
names(bandlist[[i]][[1:7]]))
}
return(bandlist)
}
aois_final <- aois_clean_bandnames(aois_clean)
??`terra-package`
??terra
packageVersion("terra")
detach("terra")
detach(package:terra)
install.packages("terra")
install.packages("terra")
install.packages("terra")
packageVersion("terra")
aois_clean
install.packages("terra")
detach(package:terra, unload = T)
remove.packages("terra")
install.packages("terra")
install.packages("terra")
packageVersion("terra")
library(terra)
